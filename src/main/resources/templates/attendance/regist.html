<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Page Example</title>
	<link th:href="@{/css/styles.css}" rel="stylesheet">
	<style>
		.user-info p {
			display: inline-block;
			margin-right: 5px;
			margin-left: 20px;
		}

		.user-info span {
			display: inline-block;
		}
	</style>
</head>

<body>

	<form id="AttendanceForm" th:action="@{/attendance/show}" method="POST">

		<div class="container">
			<div class="user-info">
				<p>ユーザ名：</p><span th:text="${user.name}"></span>
				<p>ユーザID：</p><span name="userId" th:text="${user.id}"></span>
				<p>ステータス</p><span>未申請</span>
				<input type="hidden" name="userId" th:value="${user.id}">
			</div>
			<div class="header">

				<div class="display-month">
					<label for="yearDropdown">表示年月：</label>
					<select id="yearDropdown" name="year">
						<option value=""></option>
						<option th:each="year : ${#numbers.sequence(2020, 2025)}" th:value="${year}" th:text="${year}"
							th:selected="${year == selectedYear}"></option>
					</select>
					<label for="yearDropdown">年</label>
					<select id="monthDropdown" name="month">
						<option value=""></option>
						<option th:each="month : ${#numbers.sequence(1, 12)}" th:value="${month}" th:text="${month}"
							th:selected="${month == selectedMonth}"></option>
					</select>
					<label for="monthDropdown">月</label>
					<div class="buttons">
						<button type="submit" name="show">表示</button>
					</div>

				</div>

				<th:block th:if="${errorMessage}">
					<div class="d-flex flex-column">
						<span th:text="'*' + '&nbsp' + ${errorMessage}" class="help-inline error"></span>
					</div>
				</th:block>

				<div class="buttons">
					<button>却下</button>
					<button>承認</button>
					<button>承認申請</button>

					<button type="submit" name="register">登録</button>

				</div>


			</div>

			<table class="approval-info">
				<thead>
					<tr>
						<th>承認申請者</th>
						<th>申請対象年月</th>
						<th>申請日</th>
					</tr>
				</thead>
				<tbody>
					<form name="request" method="POST">
						<tr th:each="reqList : ${attendanceReqList}" th:data-target-year-month="${reqList.targetYearMonth}"
							th:data-user-id="${reqList.userId}">
							<td>
								<nav><a href="javascript:void(0);" onclick="applicant(this);">
										[[${reqList.name}]]
									</a>
								</nav>
							</td>
							<td th:text="${reqList.targetYearMonth}">申請対象年月の表示</td>
							<td th:text="${reqList.date}">申請日の表示</td>
							<input type="hidden" th:value="${reqList.targetYearMonth}" name="targetYearMonth">
							<input type="hidden" th:value="${reqList.userId}" name="userId">
						</tr>
					</form>
				</tbody>
			</table>


			<script>

				function applicant(linkElement) {
					// リンクが属する最も近い＜tr＞タグを取得
					const trElement = linkElement.closest('tr');
					// 確定した＜tr＞タグからそれぞれの値を取得
					const targetYearMonth = trElement.getAttribute('data-target-year-month');
					const userId = trElement.getAttribute('data-user-id');

					// サーバーにリクエストを送信
					fetch('/attendance/request', {
						method: 'POST',
						body: new URLSearchParams({
							targetYearMonth: targetYearMonth,
							userId: userId
						})
					})
				}
			</script>


			<table class="attendance-info">

				<thead>
					<tr>
						<th>日付</th>
						<th>曜日</th>
						<th>出勤状況</th>
						<th>出勤時間</th>
						<th>退勤時間</th>
						<th>備考</th>
					</tr>
				</thead>
				<tbody id="dateTable">

					<tr th:each="calendera : ${calendar}">

						<td name="formattedDate" th:text="${calendera.formattedDate}">Date</td>
						<input type="hidden" name="formattedDate" th:value="${calendera.formattedDate}">
						<td th:text="${calendera.formattedWeek}">formattedWeek</td>
						<td>
							<select name="status">
								<option value="-1" th:selected="${calendera.status == null}"></option>
								<option value="0" th:selected="${calendera.status == 0}">通常出勤</option>
								<option value="1" th:selected="${calendera.status == 1}">休日</option>
								<option value="2" th:selected="${calendera.status == 2}">祝日</option>
								<option value="3" th:selected="${calendera.status == 3}">遅刻</option>
								<option value="4" th:selected="${calendera.status == 4}">有給</option>
								<option value="5" th:selected="${calendera.status == 5}">欠勤</option>
								<option value="6" th:selected="${calendera.status == 6}">早退</option>
								<option value="7" th:selected="${calendera.status == 7}">時間外勤務</option>
								<option value="8" th:selected="${calendera.status == 8}">振替出勤</option>
								<option value="9" th:selected="${calendera.status == 9}">振替休日</option>
								<option value="10" th:selected="${calendera.status == 10}">代替出勤</option>
								<option value="11" th:selected="${calendera.status == 11}">代替休日</option>
							</select>
						</td>

						<td>
							<select name="startHour">
								<option value=""></option>
								<option th:each="hour : ${#numbers.sequence(0, 23)}" th:value="${hour}"
									th:text="${hour}" th:selected="${calendera.startHour == hour}"></option>
							</select>

							:
							<select name="startMinute">
								<option value=""></option>
								<option th:each="minute : ${#numbers.sequence(0,59)}" th:value="${minute}"
									th:text="${minute}" th:selected="${calendera.startMinute == minute}"></option>
							</select>
						</td>
						<td>
							<select name="endHour">
								<option value=""></option>
								<option th:each="hour : ${#numbers.sequence(0,23)}" th:value="${hour}" th:text="${hour}"
									th:selected="${calendera.endHour == hour}"></option>
							</select>
							:
							<select name="endMinute">
								<option value=""></option>
								<option th:each="minute : ${#numbers.sequence(0,59)}" th:value="${minute}"
									th:text="${minute}" th:selected="${calendera.endMinute == minute}"></option>
							</select>
						</td>

						<td><input type="text" name="remarks" th:value="${calendera.remarks}" /></td>
					</tr>
				</tbody>
			</table>
		</div>
	</form>



</body>

</html>